{% extends "base.html" %}
{% block conteudo %}

<h1 class="mb-4">{{ titulo }}</h1>

<!-- ========= CARDS ========= -->
<div class="row mb-4">

    <div class="col-md-3">
        <div class="card shadow clickable-card" data-entity="usuarios">
            <div class="card-body text-center">
                <h6>Usuários</h6>
                <p class="fs-3">{{ total_usuarios }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow clickable-card" data-entity="veiculos">
            <div class="card-body text-center">
                <h6>Veículos</h6>
                <p class="fs-3">{{ total_veiculos }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow clickable-card" data-entity="equipamentos">
            <div class="card-body text-center">
                <h6>Equipamentos</h6>
                <p class="fs-3">{{ total_equipamentos }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow">
            <div class="card-body text-center">
                <h6>Acessos Negados Hoje</h6>
                <p class="fs-3 text-danger">{{ acessos_negados_hoje }}</p>
            </div>
        </div>
    </div>

</div>

<!-- ========= CONTROLES ========= -->
<div class="mb-3 d-flex gap-2">
    <button id="btnMostrarTudo" class="btn btn-outline-secondary btn-sm">Mostrar Tudo</button>
</div>

<!-- ========= ÁREA DINÂMICA ========= -->
<div id="area-dinamica">

    <div class="row">

        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-header">
                    <h6 id="titulo-grafico-principal" class="m-0">Gráfico Principal</h6>
                </div>
                <div class="card-body" style="height: 350px;">
                    <canvas id="grafPrincipal"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-header">
                    <h6 id="titulo-grafico-secundario" class="m-0">Segundo Gráfico</h6>
                </div>
                <div class="card-body" style="height: 350px;">
                    <canvas id="grafSecundario"></canvas>
                </div>
            </div>
        </div>

    </div>

    <div class="card shadow">
        <div class="card-header">
            <h6 id="titulo-tabela" class="m-0">Tabela</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="tabela-dinamica" class="table table-striped table-bordered">
                    <thead id="tabela-head"></thead>
                    <tbody id="tabela-body"></tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Dashboard JS separado -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<script>
    // Passar dados iniciais do backend para o JS (bootstrap)
    window.dashboardData = {
        usuariosLabels: {{ grafico_usuarios_labels|tojson }},
        usuariosValores: {{ grafico_usuarios_valores|tojson }},
        loginLabels: {{ grafico_login_labels|tojson }},
        loginValores: {{ grafico_login_valores|tojson }},
        operLabels: {{ grafico_operacao_labels|tojson }},
        operValores: {{ grafico_operacao_valores|tojson }},
        logsIniciais: [
            {% for log in ultimos_logs %}
            {
                "ID": "{{ log.id }}",
                "Data": "{{ log.horario_brasil.strftime('%d/%m/%Y %H:%M') }}",
                "Usuário": "{{ log.usuario_nome }}",
                "Operação": "{{ log.tipo_operacao }}",
                "Descrição": "{{ log.descricao|replace('\n',' ') }}"
            },
            {% endfor %}
        ]
    };
</script>

{% endblock %}
